@prefix form: <http://lblod.data.gift/vocabularies/forms/> .
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix mu: <http://mu.semte.ch/vocabularies/core/> .
@prefix displayTypes: <http://lblod.data.gift/display-types/> .
@prefix ext: <http://mu.semte.ch/vocabularies/ext/> .
@prefix schema: <http://schema.org/>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix nie: <http://www.semanticdesktop.org/ontologies/2007/01/19/nie#>.

##########################################################
# form
##########################################################
ext:form a form:Form, form:TopLevelForm ;
  form:includes ext:propertyGroupL;
  form:includes ext:formNodesL;
  form:includes ext:formListingL;
  form:includes ext:formListingTableL.

##########################################################
#  property-group
##########################################################
ext:mainPg a form:PropertyGroup;
    sh:name "Edit Form Fields" ;
    sh:order 1 .

##########################################################
#  PropertyGroup Scope
#  TODO: allow finding triples for a "form:Scope"
#    with no "sh:path" provided.
#    We now revert to attaching the propertyGroups to
#    the "form:Form" directly.
#    Which is suboptimal, cause not really in the defined
#    model. (It's not forbidden though)
##########################################################
ext:propertyGroupS a form:Scope;
  sh:path sh:group ;
  form:constraint [
     a sh:NodeShape ;
     sh:targetNode form:PropertyGroup
  ].

##########################################################
#  PropertyGroup Listing
##########################################################
ext:propertyGroupL a form:Listing;
  form:each ext:propertyGroupItem;
  form:scope ext:propertyGroupS;
  form:createGenerator ext:propertyGroupGenerator;
  form:canAdd true;
  form:addLabel "Add new Property Group";
  form:canRemove true;
  form:removeLabel "Remove Property Group";
  sh:group ext:mainPg;
  sh:order 1 .

##########################################################
#  Generator: propertyGroup
##########################################################
ext:propertyGroupGenerator a form:Generator;
  form:prototype [
    form:shape [
      a form:PropertyGroup ;
      sh:name "Provide the a title to the property group";
      sh:order 0;
      sh:path [];
      form:displayType displayTypes:defaultInput
    ]
  ].

##########################################################
#  Subform: propertyGroup
##########################################################
ext:propertyGroupItem a form:SubForm;
  form:includes ext:propertyGroupNameF;
  form:includes ext:propertyGroupOrderF;
  form:hasFieldGroup ext:mainPg.

ext:propertyGroupNameF a form:Field ;
  sh:name "Title of the property group" ;
  sh:order 1 ;
  form:help """
    A Property group helps to add sections to the form.
   """;
  sh:path sh:name ;
  form:displayType displayTypes:textArea  ;
  sh:group ext:mainPg .

ext:propertyGroupOrderF a form:Field ;
  sh:name "The order the property group should appear" ;
  sh:order 2 ;
  sh:path sh:order ;
  form:help """
    Order of the section, calculated from top to bottom. The bigger the number, the lower it will render.
   """;
  form:displayType displayTypes:numericalInput;
  sh:group ext:mainPg .

##########################################################
#  listing-scope:
##########################################################
ext:formNodesS a form:Scope;
  sh:path form:includes.

ext:formNodesL a form:Listing;
  form:each ext:formNodesFormItem;
  form:scope ext:formNodesS;
  form:createGenerator ext:formNodesGenerator;
  form:canAdd true;
  form:addLabel "Add new field";
  form:canRemove true;
  form:removeLabel "RemoveField";
  sh:group ext:mainPg;
  sh:order 2 .

##########################################################
#  Subform: formNodesFormItem
##########################################################
ext:formNodesFormItem a form:SubForm;
  form:includes ext:formNodesNameF;
  form:includes ext:formNodesOrderF;
  form:includes ext:formNodesTypeF;
  form:includes ext:formNodeHelpTextF;
  form:includes ext:formNodeOptionsF;
  form:hasFieldGroup ext:mainPg.

ext:formNodesNameF a form:Field ;
  sh:name "Name of the field" ;
  sh:order 1 ;
  form:help """
    Help the user to figure out what is asked? E.g. "First name"; "Book ISBN".
   """;
  sh:path sh:name ;
  form:displayType displayTypes:defaultInput;
  sh:group ext:mainPg .

ext:formNodesOrderF a form:Field ;
  sh:name "Order of the field" ;
  sh:order 2 ;
  sh:path sh:order ;
  form:help """
    Order of the field, calculated from top to bottom. The bigger the number, the lower it will render.
   """;
  form:displayType displayTypes:numericalInput;
  sh:group ext:mainPg .

ext:formNodesTypeF a form:Field ;
  sh:name "Display type" ;
  sh:order 3 ;
  sh:path form:displayType ;
  form:help """
    Provide the type of field.
   """;
  form:displayType displayTypes:conceptSchemeSelector ;
  form:options """{"conceptScheme":"http://lblod.data.gift/concept-schemes/c5a91bd7-3eb5-4d69-a51b-9bac6bf345f6","searchEnabled":true}""" ;
  sh:group ext:mainPg .

ext:formNodeHelpTextF a form:Field;
  sh:name "Help text of the field" ;
  sh:order 4 ;
  sh:path form:help ;
  form:help """
    The helptext of the field. \n
    Note: it won't work in all fields. \n
    Accepts HTML e.g.: <a href="https://example.com">example<a/>
  """;
  form:displayType displayTypes:textArea;
  sh:group ext:mainPg .

ext:formNodeOptionsF a form:Field;
  sh:name "Extra configuration options as JSON" ;
  form:help """
    For some fields (e.g. selectbox) we need to provide extra configuration parameters through JSON. <br>
    Note: this might be a bit technical ðŸ¤“.
    <br> E.g.: <br>
    {"conceptScheme":"https://data.vlaanderen.be/id/conceptscheme/BesluitType","searchEnabled":false}
   """;
  sh:order 5 ;
  sh:path form:options ;
  form:displayType displayTypes:textArea;
  sh:group ext:mainPg .

##########################################################
#  Generator: formNodesForm
##########################################################
ext:formNodesGenerator a form:Generator;
  form:prototype [
    form:shape [
      a form:Field ;
      sh:name "Provide Name of Field";
      sh:order 0;
      sh:path [];
      form:displayType displayTypes:defaultInput;
      sh:group ext:mainPg
    ]
  ].

##########################################################
#  listing-scope:
##########################################################
ext:formListingS a form:Scope;
  sh:path form:includes;
  form:constraint [
     a sh:NodeShape ;
     sh:property [
       sh:path rdf:type ;
       sh:targetNode form:Listing
     ];
  ].

##########################################################
#  listing: formListingL
##########################################################
ext:formListingL a form:Listing;
  form:each ext:formListingFormItem;
  form:scope ext:formListingS;
  form:createGenerator ext:formListingGenerator;
  form:canAdd true;
  form:addLabel "Add new Listing";
  form:canRemove true;
  sh:group ext:mainPg;
  sh:order 3 .

##########################################################
#  listing: formListingL (as table)
##########################################################
ext:formListingTableL a form:Listing;
  form:each ext:formListingFormItem;
  form:scope ext:formListingS;
  form:createGenerator ext:formListingTableGenerator;
  form:canAdd true;
  form:addLabel "Add new Listing (as table)";
  form:canRemove true;
  sh:group ext:mainPg;
  sh:order 4 .

##########################################################
#  Subform: ext:formListingFormItem
##########################################################
ext:formListingFormItem a form:SubForm;
  form:includes ext:formListingAddF;
  form:includes ext:formListingRemoveF;
  form:includes ext:subFormTitleF;
  form:includes ext:subformNodesL;
  form:hasFieldGroup ext:mainPg.

ext:formListingAddF a form:Field ;
  sh:name "Edit the add label" ;
  form:help """
  The add label helps the user to figure out what needs to be added. 'Add Book', 'Add Subsidy Measure', etc..
  """;
  sh:order 10 ;
  sh:path form:addLabel ;
  form:displayType displayTypes:defaultInput;
  sh:group ext:mainPg .

ext:formListingRemoveF a form:Field ;
  sh:name "Edit the remove label" ;
  form:help """
  The remove label helps the user to figure out what needs to be removed. 'Remove Book', 'Remove Subsidy Measure', etc..
  """;
  sh:order 20 ;
  sh:path ( form:each form:removeLabel ) ;
  form:displayType displayTypes:defaultInput;
  sh:group ext:mainPg .

ext:subFormTitleF a form:Field ;
  sh:name "Edit the title of the subform" ;
  form:help """
  This field gives an overview of what the next sub form will be about. 'Overview Books', 'Overview Subsidy Measures', etc..
  """;
  sh:order 30 ;
  sh:path (form:each sh:name) ;
  form:displayType displayTypes:defaultInput;
  sh:group ext:mainPg .

##########################################################
#  Generators for listing (both table and non-table)
##########################################################
# Non Table
ext:formListingGenerator a form:Generator;
  form:prototype [
    form:shape [
      a form:Listing;
      form:each [
        a form:SubForm;
        sh:name "The subform title";
        form:includes [
          a form:Field ;
          sh:name "The Nested Field" ;
          sh:order 1 ;
          sh:path [] ;
          form:displayType displayTypes:defaultInput;
          sh:group ext:mainPg
        ];
        form:removeLabel "Remove entry text";
        form:hasFieldGroup ext:mainPg
      ];
      form:scope [
        a form:Scope;
        sh:path [];
      ];
      form:createGenerator [
        a form:Generator;
        form:prototype [
          form:shape [
            a form:Field
          ]
       ]
      ];
      form:canAdd true;
      form:addLabel "Add entry text";
      form:canRemove true;
      sh:group ext:mainPg;
      sh:order 3
    ]
  ].

# Table
ext:formListingTableGenerator a form:Generator;
  form:prototype [
    form:shape [
      a form:Listing, form:ListingTable;
      form:each [
        a form:SubForm;
        sh:name "The subform title";
        form:includes [
          a form:Field ;
          sh:name "The Nested Field" ;
          sh:order 1 ;
          sh:path [] ;
          form:displayType displayTypes:defaultInput;
          sh:group ext:mainPg
        ];
        form:removeLabel "Remove row text";
        form:hasFieldGroup ext:mainPg
      ];
      form:scope [
        a form:Scope;
        sh:path [];
      ];
      form:createGenerator [
        a form:Generator;
        form:prototype [
          form:shape [
            a form:Field
          ]
       ]
      ];
      form:canAdd true;
      form:addLabel "Add row text";
      form:canRemove true;
      sh:group ext:mainPg;
      sh:order 3
    ]
  ].

##########################################################
#  listing-scope:
##########################################################
ext:subformNodesLS a form:Scope;
  sh:path ( form:each form:includes ).

ext:subformNodesL a form:Listing;
  form:each ext:formNodesFormItem;
  form:scope ext:subformNodesLS;
  form:createGenerator ext:formNodesGenerator;
  form:canAdd true;
  form:addLabel "Add new field";
  form:canRemove true;
  form:removeLabel "Remove Field";
  sh:group ext:mainPg;
  sh:order 40 .
